import{y as ie,o as _,z as se,a as V,b as le,A as ue,H as ce,B as X,C as H,F as M,Q as L,ao as fe,ap as de,I as B,K as we,J as ve,aq as q,G as W,W as pe,ar as Y,as as Z,at as he,au as k,M as ee,O as me,av as J,aw as ge,ax as z,ay as te,az as ye,aA as _e,aB as Ae,aC as Ee,f as Se,aD as Ie,aE as re,q as be,aF as Te}from"./CPEBjra4.js";function Je(a,t){return t}function Re(a,t,e){for(var r=a.items,n=[],o=t.length,i=0;i<o;i++)_e(t[i].e,n,!0);var c=o>0&&n.length===0&&e!==null;if(c){var g=e.parentNode;Ae(g),g.append(e),r.clear(),I(a,t[0].prev,t[o-1].next)}Ee(n,()=>{for(var v=0;v<o;v++){var p=t[v];c||(r.delete(p.k),I(a,p.prev,p.next)),te(p.e,!c)}})}function Fe(a,t,e,r,n,o=null){var i=a,c={flags:t,items:new Map,first:null},g=(t&re)!==0;if(g){var v=a;i=_?H(Ie(v)):v.appendChild(W())}_&&se();var p=null,T=!1,A=new Map,R=le(()=>{var w=e();return he(w)?w:w==null?[]:Z(w)}),l,d;function f(){Ce(d,l,c,A,i,n,t,r,e),o!==null&&(l.length===0?p?ee(p):p=B(()=>o(i)):p!==null&&me(p,()=>{p=null}))}ie(()=>{d??=Se,l=V(R);var w=l.length;if(T&&w===0)return;T=w===0;let y=!1;if(_){var E=ue(i)===ce;E!==(w===0)&&(i=X(),H(i),M(!1),y=!0)}if(_){for(var b=null,h,s=0;s<w;s++){if(L.nodeType===fe&&L.data===de){i=L,y=!0,M(!1);break}var u=l[s],m=r(u,s);h=G(L,c,b,null,u,m,s,n,t,e),c.items.set(m,h),b=h}w>0&&H(X())}if(_)w===0&&o&&(p=B(()=>o(i)));else if(we()){var K=new Set,N=ve;for(s=0;s<w;s+=1){u=l[s],m=r(u,s);var C=c.items.get(m)??A.get(m);C?(t&(J|k))!==0&&ae(C,u,s,t):(h=G(null,c,null,null,u,m,s,n,t,e,!0),A.set(m,h)),K.add(m)}for(const[S,P]of c.items)K.has(S)||N.skipped_effects.add(P.e);N.add_callback(f)}else f();y&&M(!0),V(R)}),_&&(i=L)}function Ce(a,t,e,r,n,o,i,c,g){var v=(i&Te)!==0,p=(i&(J|k))!==0,T=t.length,A=e.items,R=e.first,l=R,d,f=null,w,y=[],E=[],b,h,s,u;if(v)for(u=0;u<T;u+=1)b=t[u],h=c(b,u),s=A.get(h),s!==void 0&&(s.a?.measure(),(w??=new Set).add(s));for(u=0;u<T;u+=1){if(b=t[u],h=c(b,u),s=A.get(h),s===void 0){var m=r.get(h);if(m!==void 0){r.delete(h),A.set(h,m);var K=f?f.next:l;I(e,f,m),I(e,m,K),j(m,K,n),f=m}else{var N=l?l.e.nodes_start:n;f=G(N,e,f,f===null?e.first:f.next,b,h,u,o,i,g)}A.set(h,f),y=[],E=[],l=f.next;continue}if(p&&ae(s,b,u,i),(s.e.f&z)!==0&&(ee(s.e),v&&(s.a?.unfix(),(w??=new Set).delete(s))),s!==l){if(d!==void 0&&d.has(s)){if(y.length<E.length){var C=E[0],S;f=C.prev;var P=y[0],F=y[y.length-1];for(S=0;S<y.length;S+=1)j(y[S],C,n);for(S=0;S<E.length;S+=1)d.delete(E[S]);I(e,P.prev,F.next),I(e,f,P),I(e,F,C),l=C,f=F,u-=1,y=[],E=[]}else d.delete(s),j(s,l,n),I(e,s.prev,s.next),I(e,s,f===null?e.first:f.next),I(e,f,s),f=s;continue}for(y=[],E=[];l!==null&&l.k!==h;)(l.e.f&z)===0&&(d??=new Set).add(l),E.push(l),l=l.next;if(l===null)continue;s=l}y.push(s),f=s,l=s.next}if(l!==null||d!==void 0){for(var O=d===void 0?[]:Z(d);l!==null;)(l.e.f&z)===0&&O.push(l),l=l.next;var x=O.length;if(x>0){var ne=(i&re)!==0&&T===0?n:null;if(v){for(u=0;u<x;u+=1)O[u].a?.measure();for(u=0;u<x;u+=1)O[u].a?.fix()}Re(e,O,ne)}}v&&be(()=>{if(w!==void 0)for(s of w)s.a?.apply()}),a.first=e.first&&e.first.e,a.last=f&&f.e;for(var oe of r.values())te(oe.e);r.clear()}function ae(a,t,e,r){(r&J)!==0&&q(a.v,t),(r&k)!==0?q(a.i,e):a.i=e}function G(a,t,e,r,n,o,i,c,g,v,p){var T=(g&J)!==0,A=(g&ge)===0,R=T?A?pe(n,!1,!1):Y(n):n,l=(g&k)===0?i:Y(i),d={i:l,v:R,k:o,a:null,e:null,prev:e,next:r};try{if(a===null){var f=document.createDocumentFragment();f.append(a=W())}return d.e=B(()=>c(a,R,l,v),_),d.e.prev=e&&e.e,d.e.next=r&&r.e,e===null?p||(t.first=d):(e.next=d,e.e.next=d.e),r!==null&&(r.prev=d,r.e.prev=d.e),d}finally{}}function j(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,n=t?t.e.nodes_start:e,o=a.e.nodes_start;o!==null&&o!==r;){var i=ye(o);n.before(o),o=i}}function I(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const Q=[...` 	
\r\fÂ \v\uFEFF`];function Ke(a,t,e){var r=a==null?"":""+a;if(e){for(var n in e)if(e[n])r=r?r+" "+n:n;else if(r.length)for(var o=n.length,i=0;(i=r.indexOf(n,i))>=0;){var c=i+o;(i===0||Q.includes(r[i-1]))&&(c===r.length||Q.includes(r[c]))?r=(i===0?"":r.substring(0,i))+r.substring(c+1):i=c}}return r===""?null:r}function Oe(a,t){return a==null?null:String(a)}function xe(a,t,e,r,n,o){var i=a.__className;if(_||i!==e||i===void 0){var c=Ke(e,r,o);(!_||c!==a.getAttribute("class"))&&(c==null?a.removeAttribute("class"):a.className=c),a.__className=e}else if(o&&n!==o)for(var g in o){var v=!!o[g];(n==null||v!==!!n[g])&&a.classList.toggle(g,v)}return o}function He(a,t,e,r){var n=a.__style;if(_||n!==t){var o=Oe(t);(!_||o!==a.getAttribute("style"))&&(o==null?a.removeAttribute("style"):a.style.cssText=o),a.__style=t}return r}const D={API_BASE_URL:`https://us-central1-topic-tangle.cloudfunctions.net/tangle-api/tangle\r
`,POLL_INTERVAL:parseInt("2500")},$="topic-tangle-key-";async function Le(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"])}async function Ne(a,t){const e=await window.crypto.subtle.exportKey("jwk",t.publicKey);localStorage.setItem(`${$}${a}:public`,JSON.stringify(e));const r=await window.crypto.subtle.exportKey("jwk",t.privateKey);localStorage.setItem(`${$}${a}:private`,JSON.stringify(r))}async function Pe(a){const t=localStorage.getItem(`${$}${a}:public`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}async function De(a){const t=localStorage.getItem(`${$}${a}:private`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["sign"])}async function Ue(a,t){const e=await De(a);if(!e)throw new Error(`Private key '${a}' not found.`);const n=new TextEncoder().encode(t),o=await window.crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},e,n);return btoa(String.fromCharCode(...new Uint8Array(o)))}async function $e(a){let t=await Pe(a);if(!t){const r=await Le();await Ne(a,r),t=r.publicKey}const e=await window.crypto.subtle.exportKey("spki",t);return btoa(String.fromCharCode(...new Uint8Array(e)))}async function U(){const a="user",t=new Date().toISOString(),e=await $e(a),r=await Ue(a,t);return{"Content-Type":"application/json","X-User-Id":e,"X-Timestamp":t,"X-Signature":r}}class Me{static POLL_INTERVAL=D.POLL_INTERVAL;static getRoomUrl(t,e=""){return`${D.API_BASE_URL}/rooms/${t}${e}`}static async createRoom(t){const e=await U(),r=await fetch(`${D.API_BASE_URL}/rooms`,{method:"POST",headers:e,body:JSON.stringify({organizerId:t.organizerId,topics:t.topics,minGroupSize:t.minGroupSize,maxGroupSize:t.maxGroupSize})});if(!r.ok){const o=await r.json();throw new Error(o.error||"Failed to create room")}const n=await r.json();return n.createdAt=new Date(n.createdAt),n}static async getRoom(t){try{const e=await fetch(this.getRoomUrl(t));if(e.status===404)return null;if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to get room")}const r=await e.json();return r.createdAt=new Date(r.createdAt),r}catch(e){return console.error("Failed to get room:",e),null}}static async submitUserSelection(t){const e=await U();if(t.selectedTopics.length===0){const n=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"DELETE",headers:e});if(!n.ok){const o=await n.json();throw new Error(o.error||"Failed to delete selection")}return}const r=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"POST",headers:e,body:JSON.stringify({selectedTopics:t.selectedTopics})});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to submit selection")}}static async createBreakoutGroups(t,e){const r=await U(),n=await fetch(`${D.API_BASE_URL}/rooms/${t}/breakout`,{method:"POST",headers:r});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to create breakout groups")}const o=await n.json();return o.createdAt=new Date(o.createdAt),o}static async getRoomData(t){try{const e=await U(),r=await fetch(this.getRoomUrl(t,"/data"),{headers:e});if(!r.ok){const i=await r.json();throw new Error(i.error||"Failed to get room data")}const{selections:n,results:o}=await r.json();return{selections:n.map(i=>({...i,updatedAt:new Date(i.updatedAt)})),results:o?{...o,createdAt:new Date(o.createdAt)}:null}}catch(e){return console.error("Failed to get room data:",e),{selections:[],results:null}}}static createPollingSubscription(t,e,r=this.POLL_INTERVAL){let n;const o=async()=>{try{const i=await t();e(i)&&(n=setTimeout(o,r))}catch(i){console.error("Polling error:",i),n=setTimeout(o,r)}};return o(),()=>{n&&clearTimeout(n)}}}export{Me as R,He as a,Fe as e,$e as g,Je as i,xe as s};
