import{y as oe,o as g,z as se,a as G,b as le,A as ue,H as ce,B as X,C as H,F as M,Q as P,ao as fe,ap as de,I as B,K as we,J as ve,aq as q,G as W,W as pe,ar as Y,as as Z,at as he,au as k,M as ee,O as me,av as J,aw as _e,ax as V,ay as te,az as ye,aA as ge,aB as Ae,aC as Ee,f as Se,aD as Ie,aE as re,q as Te,aF as be}from"./CPEBjra4.js";function Je(a,t){return t}function Re(a,t,e){for(var r=a.items,n=[],i=t.length,o=0;o<i;o++)ge(t[o].e,n,!0);var f=i>0&&n.length===0&&e!==null;if(f){var _=e.parentNode;Ae(_),_.append(e),r.clear(),I(a,t[0].prev,t[i-1].next)}Ee(n,()=>{for(var v=0;v<i;v++){var p=t[v];f||(r.delete(p.k),I(a,p.prev,p.next)),te(p.e,!f)}})}function Fe(a,t,e,r,n,i=null){var o=a,f={flags:t,items:new Map,first:null},_=(t&re)!==0;if(_){var v=a;o=g?H(Ie(v)):v.appendChild(W())}g&&se();var p=null,b=!1,A=new Map,R=le(()=>{var w=e();return he(w)?w:w==null?[]:Z(w)}),l,d;function c(){Le(d,l,f,A,o,n,t,r,e),i!==null&&(l.length===0?p?ee(p):p=B(()=>i(o)):p!==null&&me(p,()=>{p=null}))}oe(()=>{d??=Se,l=G(R);var w=l.length;if(b&&w===0)return;b=w===0;let y=!1;if(g){var E=ue(o)===ce;E!==(w===0)&&(o=X(),H(o),M(!1),y=!0)}if(g){for(var T=null,h,s=0;s<w;s++){if(P.nodeType===fe&&P.data===de){o=P,y=!0,M(!1);break}var u=l[s],m=r(u,s);h=j(P,f,T,null,u,m,s,n,t,e),f.items.set(m,h),T=h}w>0&&H(X())}if(g)w===0&&i&&(p=B(()=>i(o)));else if(we()){var C=new Set,K=ve;for(s=0;s<w;s+=1){u=l[s],m=r(u,s);var L=f.items.get(m)??A.get(m);L?(t&(J|k))!==0&&ae(L,u,s,t):(h=j(null,f,null,null,u,m,s,n,t,e,!0),A.set(m,h)),C.add(m)}for(const[S,N]of f.items)C.has(S)||K.skipped_effects.add(N.e);K.add_callback(c)}else c();y&&M(!0),G(R)}),g&&(o=P)}function Le(a,t,e,r,n,i,o,f,_){var v=(o&be)!==0,p=(o&(J|k))!==0,b=t.length,A=e.items,R=e.first,l=R,d,c=null,w,y=[],E=[],T,h,s,u;if(v)for(u=0;u<b;u+=1)T=t[u],h=f(T,u),s=A.get(h),s!==void 0&&(s.a?.measure(),(w??=new Set).add(s));for(u=0;u<b;u+=1){if(T=t[u],h=f(T,u),s=A.get(h),s===void 0){var m=r.get(h);if(m!==void 0){r.delete(h),A.set(h,m);var C=c?c.next:l;I(e,c,m),I(e,m,C),z(m,C,n),c=m}else{var K=l?l.e.nodes_start:n;c=j(K,e,c,c===null?e.first:c.next,T,h,u,i,o,_)}A.set(h,c),y=[],E=[],l=c.next;continue}if(p&&ae(s,T,u,o),(s.e.f&V)!==0&&(ee(s.e),v&&(s.a?.unfix(),(w??=new Set).delete(s))),s!==l){if(d!==void 0&&d.has(s)){if(y.length<E.length){var L=E[0],S;c=L.prev;var N=y[0],F=y[y.length-1];for(S=0;S<y.length;S+=1)z(y[S],L,n);for(S=0;S<E.length;S+=1)d.delete(E[S]);I(e,N.prev,F.next),I(e,c,N),I(e,F,L),l=L,c=F,u-=1,y=[],E=[]}else d.delete(s),z(s,l,n),I(e,s.prev,s.next),I(e,s,c===null?e.first:c.next),I(e,c,s),c=s;continue}for(y=[],E=[];l!==null&&l.k!==h;)(l.e.f&V)===0&&(d??=new Set).add(l),E.push(l),l=l.next;if(l===null)continue;s=l}y.push(s),c=s,l=s.next}if(l!==null||d!==void 0){for(var O=d===void 0?[]:Z(d);l!==null;)(l.e.f&V)===0&&O.push(l),l=l.next;var x=O.length;if(x>0){var ne=(o&re)!==0&&b===0?n:null;if(v){for(u=0;u<x;u+=1)O[u].a?.measure();for(u=0;u<x;u+=1)O[u].a?.fix()}Re(e,O,ne)}}v&&Te(()=>{if(w!==void 0)for(s of w)s.a?.apply()}),a.first=e.first&&e.first.e,a.last=c&&c.e;for(var ie of r.values())te(ie.e);r.clear()}function ae(a,t,e,r){(r&J)!==0&&q(a.v,t),(r&k)!==0?q(a.i,e):a.i=e}function j(a,t,e,r,n,i,o,f,_,v,p){var b=(_&J)!==0,A=(_&_e)===0,R=b?A?pe(n,!1,!1):Y(n):n,l=(_&k)===0?o:Y(o),d={i:l,v:R,k:i,a:null,e:null,prev:e,next:r};try{if(a===null){var c=document.createDocumentFragment();c.append(a=W())}return d.e=B(()=>f(a,R,l,v),g),d.e.prev=e&&e.e,d.e.next=r&&r.e,e===null?p||(t.first=d):(e.next=d,e.e.next=d.e),r!==null&&(r.prev=d,r.e.prev=d.e),d}finally{}}function z(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,n=t?t.e.nodes_start:e,i=a.e.nodes_start;i!==null&&i!==r;){var o=ye(i);n.before(i),i=o}}function I(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const Q=[...` 	
\r\fÂ \v\uFEFF`];function Ce(a,t,e){var r=a==null?"":""+a;if(e){for(var n in e)if(e[n])r=r?r+" "+n:n;else if(r.length)for(var i=n.length,o=0;(o=r.indexOf(n,o))>=0;){var f=o+i;(o===0||Q.includes(r[o-1]))&&(f===r.length||Q.includes(r[f]))?r=(o===0?"":r.substring(0,o))+r.substring(f+1):o=f}}return r===""?null:r}function Oe(a,t){return a==null?null:String(a)}function xe(a,t,e,r,n,i){var o=a.__className;if(g||o!==e||o===void 0){var f=Ce(e,r,i);(!g||f!==a.getAttribute("class"))&&(f==null?a.removeAttribute("class"):a.className=f),a.__className=e}else if(i&&n!==i)for(var _ in i){var v=!!i[_];(n==null||v!==!!n[_])&&a.classList.toggle(_,v)}return i}function He(a,t,e,r){var n=a.__style;if(g||n!==t){var i=Oe(t);(!g||i!==a.getAttribute("style"))&&(i==null?a.removeAttribute("style"):a.style.cssText=i),a.__style=t}return r}const D={API_BASE_URL:"${VITE_API_BASE_URL}",POLL_INTERVAL:parseInt("${VITE_POLL_INTERVAL}")},U="topic-tangle-key-";async function Pe(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"])}async function Ke(a,t){const e=await window.crypto.subtle.exportKey("jwk",t.publicKey);localStorage.setItem(`${U}${a}:public`,JSON.stringify(e));const r=await window.crypto.subtle.exportKey("jwk",t.privateKey);localStorage.setItem(`${U}${a}:private`,JSON.stringify(r))}async function Ne(a){const t=localStorage.getItem(`${U}${a}:public`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}async function De(a){const t=localStorage.getItem(`${U}${a}:private`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["sign"])}async function $e(a,t){const e=await De(a);if(!e)throw new Error(`Private key '${a}' not found.`);const n=new TextEncoder().encode(t),i=await window.crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},e,n);return btoa(String.fromCharCode(...new Uint8Array(i)))}async function Ue(a){let t=await Ne(a);if(!t){const r=await Pe();await Ke(a,r),t=r.publicKey}const e=await window.crypto.subtle.exportKey("spki",t);return btoa(String.fromCharCode(...new Uint8Array(e)))}async function $(){const a="user",t=new Date().toISOString(),e=await Ue(a),r=await $e(a,t);return{"Content-Type":"application/json","X-User-Id":e,"X-Timestamp":t,"X-Signature":r}}class Me{static POLL_INTERVAL=D.POLL_INTERVAL;static getRoomUrl(t,e=""){return`${D.API_BASE_URL}/rooms/${t}${e}`}static async createRoom(t){const e=await $(),r=await fetch(`${D.API_BASE_URL}/rooms`,{method:"POST",headers:e,body:JSON.stringify({organizerId:t.organizerId,topics:t.topics,minGroupSize:t.minGroupSize,maxGroupSize:t.maxGroupSize})});if(!r.ok){const i=await r.json();throw new Error(i.error||"Failed to create room")}const n=await r.json();return n.createdAt=new Date(n.createdAt),n}static async getRoom(t){try{const e=await fetch(this.getRoomUrl(t));if(e.status===404)return null;if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to get room")}const r=await e.json();return r.createdAt=new Date(r.createdAt),r}catch(e){return console.error("Failed to get room:",e),null}}static async submitUserSelection(t){const e=await $();if(t.selectedTopics.length===0){const n=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"DELETE",headers:e});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to delete selection")}return}const r=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"POST",headers:e,body:JSON.stringify({selectedTopics:t.selectedTopics})});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to submit selection")}}static async createBreakoutGroups(t,e){const r=await $(),n=await fetch(`${D.API_BASE_URL}/rooms/${t}/breakout`,{method:"POST",headers:r});if(!n.ok){const o=await n.json();throw new Error(o.error||"Failed to create breakout groups")}const i=await n.json();return i.createdAt=new Date(i.createdAt),i}static async getRoomData(t){try{const e=await $(),r=await fetch(this.getRoomUrl(t,"/data"),{headers:e});if(!r.ok){const o=await r.json();throw new Error(o.error||"Failed to get room data")}const{selections:n,results:i}=await r.json();return{selections:n.map(o=>({...o,updatedAt:new Date(o.updatedAt)})),results:i?{...i,createdAt:new Date(i.createdAt)}:null}}catch(e){return console.error("Failed to get room data:",e),{selections:[],results:null}}}static createPollingSubscription(t,e,r=this.POLL_INTERVAL){let n;const i=async()=>{try{const o=await t();e(o)}catch(o){console.error("Polling error:",o)}n=setTimeout(i,r)};return i(),()=>{n&&clearTimeout(n)}}}export{Me as R,He as a,Fe as e,Ue as g,Je as i,xe as s};
