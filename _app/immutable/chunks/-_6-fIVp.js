import{e as ee,b as ue,ap as te,s as j,h as y,aq as ce,a as fe,n as X,q as de,r as we,H as pe,c as Y,d as M,k as K,ar as ve,as as he,f as V,i as me,at as F,au as J,g as _e,av as Q,N as ge,aw as W,ax as re,ay as ye,j as ae,p as Ae,az as Ee,aA as z,I as Se,aB as ne,aC as Ie,aD as be,aE as Te,aF as Re,aG as Ce,v as ke}from"./BmOFv_lr.js";let B=null;function je(a,t){return t}function Ne(a,t,e){for(var r=a.items,n=[],s=t.length,o=0;o<s;o++)Te(t[o].e,n,!0);var f=s>0&&n.length===0&&e!==null;if(f){var m=e.parentNode;Re(m),m.append(e),r.clear(),I(a,t[0].prev,t[s-1].next)}Ce(n,()=>{for(var w=0;w<s;w++){var p=t[w];f||(r.delete(p.k),I(a,p.prev,p.next)),ne(p.e,!f)}})}function Me(a,t,e,r,n,s=null){var o=a,f={flags:t,items:new Map,first:null},m=(t&te)!==0;if(m){var w=a;o=y?j(ce(w)):w.appendChild(ee())}y&&fe();var p=null,R=!1,A=new Map,k=de(()=>{var d=e();return ye(d)?d:d==null?[]:re(d)}),u,_;function l(){Pe(_,u,f,A,o,n,t,r,e),s!==null&&(u.length===0?p?ae(p):p=V(()=>s(o)):p!==null&&Ae(p,()=>{p=null}))}ue(()=>{_??=ke,u=X(k);var d=u.length;if(R&&d===0)return;R=d===0;let g=!1;if(y){var E=we(o)===pe;E!==(d===0)&&(o=Y(),j(o),M(!1),g=!0)}if(y){for(var b=null,v,i=0;i<d;i++){if(K.nodeType===ve&&K.data===he){o=K,g=!0,M(!1);break}var c=u[i],h=r(c,i);v=q(K,f,b,null,c,h,i,n,t,e),f.items.set(h,v),b=v}d>0&&j(Y())}if(y)d===0&&s&&(p=V(()=>s(o)));else if(me()){var N=new Set,L=_e;for(i=0;i<d;i+=1){c=u[i],h=r(c,i);var C=f.items.get(h)??A.get(h);C?(t&(F|J))!==0&&se(C,c,i,t):(v=q(null,f,null,null,c,h,i,n,t,e,!0),A.set(h,v)),N.add(h)}for(const[S,O]of f.items)N.has(S)||L.skipped_effects.add(O.e);L.add_callback(l)}else l();g&&M(!0),X(k)}),y&&(o=K)}function Pe(a,t,e,r,n,s,o,f,m){var w=(o&Ie)!==0,p=(o&(F|J))!==0,R=t.length,A=e.items,k=e.first,u=k,_,l=null,d,g=[],E=[],b,v,i,c;if(w)for(c=0;c<R;c+=1)b=t[c],v=f(b,c),i=A.get(v),i!==void 0&&(i.a?.measure(),(d??=new Set).add(i));for(c=0;c<R;c+=1){if(b=t[c],v=f(b,c),i=A.get(v),i===void 0){var h=r.get(v);if(h!==void 0){r.delete(v),A.set(v,h);var N=l?l.next:u;I(e,l,h),I(e,h,N),G(h,N,n),l=h}else{var L=u?u.e.nodes_start:n;l=q(L,e,l,l===null?e.first:l.next,b,v,c,s,o,m)}A.set(v,l),g=[],E=[],u=l.next;continue}if(p&&se(i,b,c,o),(i.e.f&z)!==0&&(ae(i.e),w&&(i.a?.unfix(),(d??=new Set).delete(i))),i!==u){if(_!==void 0&&_.has(i)){if(g.length<E.length){var C=E[0],S;l=C.prev;var O=g[0],x=g[g.length-1];for(S=0;S<g.length;S+=1)G(g[S],C,n);for(S=0;S<E.length;S+=1)_.delete(E[S]);I(e,O.prev,x.next),I(e,l,O),I(e,x,C),u=C,l=x,c-=1,g=[],E=[]}else _.delete(i),G(i,u,n),I(e,i.prev,i.next),I(e,i,l===null?e.first:l.next),I(e,l,i),l=i;continue}for(g=[],E=[];u!==null&&u.k!==v;)(u.e.f&z)===0&&(_??=new Set).add(u),E.push(u),u=u.next;if(u===null)continue;i=u}g.push(i),l=i,u=i.next}if(u!==null||_!==void 0){for(var P=_===void 0?[]:re(_);u!==null;)(u.e.f&z)===0&&P.push(u),u=u.next;var H=P.length;if(H>0){var ie=(o&te)!==0&&R===0?n:null;if(w){for(c=0;c<H;c+=1)P[c].a?.measure();for(c=0;c<H;c+=1)P[c].a?.fix()}Ne(e,P,ie)}}w&&Se(()=>{if(d!==void 0)for(i of d)i.a?.apply()}),a.first=e.first&&e.first.e,a.last=l&&l.e;for(var le of r.values())ne(le.e);r.clear()}function se(a,t,e,r){(r&F)!==0&&Q(a.v,t),(r&J)!==0?Q(a.i,e):a.i=e}function q(a,t,e,r,n,s,o,f,m,w,p){var R=B,A=(m&F)!==0,k=(m&Ee)===0,u=A?k?ge(n,!1,!1):W(n):n,_=(m&J)===0?o:W(o),l={i:_,v:u,k:s,a:null,e:null,prev:e,next:r};B=l;try{if(a===null){var d=document.createDocumentFragment();d.append(a=ee())}return l.e=V(()=>f(a,u,_,w),y),l.e.prev=e&&e.e,l.e.next=r&&r.e,e===null?p||(t.first=l):(e.next=l,e.e.next=l.e),r!==null&&(r.prev=l,r.e.prev=l.e),l}finally{B=R}}function G(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,n=t?t.e.nodes_start:e,s=a.e.nodes_start;s!==null&&s!==r;){var o=be(s);n.before(s),s=o}}function I(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const Z=[...` 	
\r\fÂ \v\uFEFF`];function Ke(a,t,e){var r=a==null?"":""+a;if(e){for(var n in e)if(e[n])r=r?r+" "+n:n;else if(r.length)for(var s=n.length,o=0;(o=r.indexOf(n,o))>=0;){var f=o+s;(o===0||Z.includes(r[o-1]))&&(f===r.length||Z.includes(r[f]))?r=(o===0?"":r.substring(0,o))+r.substring(f+1):o=f}}return r===""?null:r}function Le(a,t){return a==null?null:String(a)}function ze(a,t,e,r,n,s){var o=a.__className;if(y||o!==e||o===void 0){var f=Ke(e,r,s);(!y||f!==a.getAttribute("class"))&&(f==null?a.removeAttribute("class"):a.className=f),a.__className=e}else if(s&&n!==s)for(var m in s){var w=!!s[m];(n==null||w!==!!n[m])&&a.classList.toggle(m,w)}return s}function Be(a,t,e,r){var n=a.__style;if(y||n!==t){var s=Le(t);(!y||s!==a.getAttribute("style"))&&(s==null?a.removeAttribute("style"):a.style.cssText=s),a.__style=t}return r}const Oe=()=>performance.now(),T={tick:a=>requestAnimationFrame(a),now:()=>Oe(),tasks:new Set};function oe(){const a=T.now();T.tasks.forEach(t=>{t.c(a)||(T.tasks.delete(t),t.f())}),T.tasks.size!==0&&T.tick(oe)}function Ge(a){let t;return T.tasks.size===0&&T.tick(oe),{promise:new Promise(e=>{T.tasks.add(t={c:a,f:e})}),abort(){T.tasks.delete(t)}}}const D={API_BASE_URL:`https://us-central1-topic-tangle.cloudfunctions.net/tangle-api/tangle\r
`,POLL_INTERVAL:parseInt("2500")},$="topic-tangle-key-";async function De(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"])}async function Ue(a,t){const e=await window.crypto.subtle.exportKey("jwk",t.publicKey);localStorage.setItem(`${$}${a}:public`,JSON.stringify(e));const r=await window.crypto.subtle.exportKey("jwk",t.privateKey);localStorage.setItem(`${$}${a}:private`,JSON.stringify(r))}async function $e(a){const t=localStorage.getItem(`${$}${a}:public`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}async function Fe(a){const t=localStorage.getItem(`${$}${a}:private`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["sign"])}async function Je(a,t){const e=await Fe(a);if(!e)throw new Error(`Private key '${a}' not found.`);const n=new TextEncoder().encode(t),s=await window.crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},e,n);return btoa(String.fromCharCode(...new Uint8Array(s)))}async function xe(a){let t=await $e(a);if(!t){const r=await De();await Ue(a,r),t=r.publicKey}const e=await window.crypto.subtle.exportKey("spki",t);return btoa(String.fromCharCode(...new Uint8Array(e)))}async function U(){const a="user",t=new Date().toISOString(),e=await xe(a),r=await Je(a,t);return{"Content-Type":"application/json","X-User-Id":e,"X-Timestamp":t,"X-Signature":r}}class Ve{static POLL_INTERVAL=D.POLL_INTERVAL;static getRoomUrl(t,e=""){return`${D.API_BASE_URL}/rooms/${t}${e}`}static async createRoom(t){const e=await U(),r=await fetch(`${D.API_BASE_URL}/rooms`,{method:"POST",headers:e,body:JSON.stringify({topics:t.topics,minGroupSize:t.minGroupSize,maxGroupSize:t.maxGroupSize,style:t.style})});if(!r.ok){const s=await r.json();throw new Error(s.error||"Failed to create room")}const n=await r.json();return n.createdAt=new Date(n.createdAt),n}static async getRoom(t){try{const e=await fetch(this.getRoomUrl(t));if(e.status===404)return null;if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to get room")}const r=await e.json();return r.createdAt=new Date(r.createdAt),r}catch(e){return console.error("Failed to get room:",e),null}}static async submitUserSelection(t){const e=await U();if(t.selectedTopics.length===0){const n=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"DELETE",headers:e});if(!n.ok){const s=await n.json();throw new Error(s.error||"Failed to delete selection")}return}const r=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"POST",headers:e,body:JSON.stringify({selectedTopics:t.selectedTopics})});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to submit selection")}}static async createBreakoutGroups(t,e){const r=await U(),n=await fetch(`${D.API_BASE_URL}/rooms/${t}/breakout`,{method:"POST",headers:r});if(!n.ok){const o=await n.json();throw new Error(o.error||"Failed to create breakout groups")}const s=await n.json();return s.createdAt=new Date(s.createdAt),s}static async getRoomData(t){try{const e=await U(),r=await fetch(this.getRoomUrl(t,"/data"),{headers:e});if(!r.ok){const o=await r.json();throw new Error(o.error||"Failed to get room data")}const{selections:n,results:s}=await r.json();return{selections:n.map(o=>({...o,updatedAt:new Date(o.updatedAt)})),results:s?{...s,createdAt:new Date(s.createdAt)}:null}}catch(e){return console.error("Failed to get room data:",e),{selections:[],results:null}}}static createPollingSubscription(t,e,r=this.POLL_INTERVAL){let n;const s=async()=>{try{const o=await t();e(o)&&(n=setTimeout(s,r))}catch(o){console.error("Polling error:",o),n=setTimeout(s,r)}};return s(),()=>{n&&clearTimeout(n)}}}export{Ve as R,Be as a,B as c,Me as e,xe as g,je as i,Ge as l,T as r,ze as s};
