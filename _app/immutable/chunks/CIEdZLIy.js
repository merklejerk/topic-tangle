import{e as ee,b as ce,ax as te,s as H,h as _,ay as fe,a as de,n as q,q as pe,r as we,H as ve,c as Y,d as M,k as D,az as he,aA as me,f as V,i as ye,aB as J,aC as F,g as ge,aD as Q,N as _e,aE as W,aF as re,aG as Ae,j as ae,p as Ee,aH as Se,aI as z,I as be,aJ as ne,aK as Ie,aL as Te,aM as Re,aN as Ce,aO as Pe,v as ke}from"./Dr_vVydj.js";let B=null;function ze(r,t){return t}function Ne(r,t,e){for(var a=r.items,n=[],s=t.length,o=0;o<s;o++)Re(t[o].e,n,!0);var f=s>0&&n.length===0&&e!==null;if(f){var m=e.parentNode;Ce(m),m.append(e),a.clear(),b(r,t[0].prev,t[s-1].next)}Pe(n,()=>{for(var p=0;p<s;p++){var w=t[p];f||(a.delete(w.k),b(r,w.prev,w.next)),ne(w.e,!f)}})}function Be(r,t,e,a,n,s=null){var o=r,f={flags:t,items:new Map,first:null},m=(t&te)!==0;if(m){var p=r;o=_?H(fe(p)):p.appendChild(ee())}_&&de();var w=null,R=!1,A=new Map,P=pe(()=>{var d=e();return Ae(d)?d:d==null?[]:re(d)}),u,y;function l(){De(y,u,f,A,o,n,t,a,e),s!==null&&(u.length===0?w?ae(w):w=V(()=>s(o)):w!==null&&Ee(w,()=>{w=null}))}ce(()=>{y??=ke,u=q(P);var d=u.length;if(R&&d===0)return;R=d===0;let g=!1;if(_){var E=we(o)===ve;E!==(d===0)&&(o=Y(),H(o),M(!1),g=!0)}if(_){for(var I=null,v,i=0;i<d;i++){if(D.nodeType===he&&D.data===me){o=D,g=!0,M(!1);break}var c=u[i],h=a(c,i);v=X(D,f,I,null,c,h,i,n,t,e),f.items.set(h,v),I=v}d>0&&H(Y())}if(_)d===0&&s&&(w=V(()=>s(o)));else if(ye()){var k=new Set,K=ge;for(i=0;i<d;i+=1){c=u[i],h=a(c,i);var C=f.items.get(h)??A.get(h);C?(t&(J|F))!==0&&se(C,c,i,t):(v=X(null,f,null,null,c,h,i,n,t,e,!0),A.set(h,v)),k.add(h)}for(const[S,L]of f.items)k.has(S)||K.skipped_effects.add(L.e);K.add_callback(l)}else l();g&&M(!0),q(P)}),_&&(o=D)}function De(r,t,e,a,n,s,o,f,m){var p=(o&Ie)!==0,w=(o&(J|F))!==0,R=t.length,A=e.items,P=e.first,u=P,y,l=null,d,g=[],E=[],I,v,i,c;if(p)for(c=0;c<R;c+=1)I=t[c],v=f(I,c),i=A.get(v),i!==void 0&&(i.a?.measure(),(d??=new Set).add(i));for(c=0;c<R;c+=1){if(I=t[c],v=f(I,c),i=A.get(v),i===void 0){var h=a.get(v);if(h!==void 0){a.delete(v),A.set(v,h);var k=l?l.next:u;b(e,l,h),b(e,h,k),G(h,k,n),l=h}else{var K=u?u.e.nodes_start:n;l=X(K,e,l,l===null?e.first:l.next,I,v,c,s,o,m)}A.set(v,l),g=[],E=[],u=l.next;continue}if(w&&se(i,I,c,o),(i.e.f&z)!==0&&(ae(i.e),p&&(i.a?.unfix(),(d??=new Set).delete(i))),i!==u){if(y!==void 0&&y.has(i)){if(g.length<E.length){var C=E[0],S;l=C.prev;var L=g[0],j=g[g.length-1];for(S=0;S<g.length;S+=1)G(g[S],C,n);for(S=0;S<E.length;S+=1)y.delete(E[S]);b(e,L.prev,j.next),b(e,l,L),b(e,j,C),u=C,l=j,c-=1,g=[],E=[]}else y.delete(i),G(i,u,n),b(e,i.prev,i.next),b(e,i,l===null?e.first:l.next),b(e,l,i),l=i;continue}for(g=[],E=[];u!==null&&u.k!==v;)(u.e.f&z)===0&&(y??=new Set).add(u),E.push(u),u=u.next;if(u===null)continue;i=u}g.push(i),l=i,u=i.next}if(u!==null||y!==void 0){for(var N=y===void 0?[]:re(y);u!==null;)(u.e.f&z)===0&&N.push(u),u=u.next;var x=N.length;if(x>0){var le=(o&te)!==0&&R===0?n:null;if(p){for(c=0;c<x;c+=1)N[c].a?.measure();for(c=0;c<x;c+=1)N[c].a?.fix()}Ne(e,N,le)}}p&&be(()=>{if(d!==void 0)for(i of d)i.a?.apply()}),r.first=e.first&&e.first.e,r.last=l&&l.e;for(var ue of a.values())ne(ue.e);a.clear()}function se(r,t,e,a){(a&J)!==0&&Q(r.v,t),(a&F)!==0?Q(r.i,e):r.i=e}function X(r,t,e,a,n,s,o,f,m,p,w){var R=B,A=(m&J)!==0,P=(m&Se)===0,u=A?P?_e(n,!1,!1):W(n):n,y=(m&F)===0?o:W(o),l={i:y,v:u,k:s,a:null,e:null,prev:e,next:a};B=l;try{if(r===null){var d=document.createDocumentFragment();d.append(r=ee())}return l.e=V(()=>f(r,u,y,p),_),l.e.prev=e&&e.e,l.e.next=a&&a.e,e===null?w||(t.first=l):(e.next=l,e.e.next=l.e),a!==null&&(a.prev=l,a.e.prev=l.e),l}finally{B=R}}function G(r,t,e){for(var a=r.next?r.next.e.nodes_start:e,n=t?t.e.nodes_start:e,s=r.e.nodes_start;s!==null&&s!==a;){var o=Te(s);n.before(s),s=o}}function b(r,t,e){t===null?r.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function oe(r){var t,e,a="";if(typeof r=="string"||typeof r=="number")a+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(t=0;t<n;t++)r[t]&&(e=oe(r[t]))&&(a&&(a+=" "),a+=e)}else for(e in r)r[e]&&(a&&(a+=" "),a+=e);return a}function Ke(){for(var r,t,e=0,a="",n=arguments.length;e<n;e++)(r=arguments[e])&&(t=oe(r))&&(a&&(a+=" "),a+=t);return a}function Ge(r){return typeof r=="object"?Ke(r):r??""}const Z=[...` 	
\r\fÂ \v\uFEFF`];function Le(r,t,e){var a=r==null?"":""+r;if(t&&(a=a?a+" "+t:t),e){for(var n in e)if(e[n])a=a?a+" "+n:n;else if(a.length)for(var s=n.length,o=0;(o=a.indexOf(n,o))>=0;){var f=o+s;(o===0||Z.includes(a[o-1]))&&(f===a.length||Z.includes(a[f]))?a=(o===0?"":a.substring(0,o))+a.substring(f+1):o=f}}return a===""?null:a}function Oe(r,t){return r==null?null:String(r)}function Ve(r,t,e,a,n,s){var o=r.__className;if(_||o!==e||o===void 0){var f=Le(e,a,s);(!_||f!==r.getAttribute("class"))&&(f==null?r.removeAttribute("class"):t?r.className=f:r.setAttribute("class",f)),r.__className=e}else if(s&&n!==s)for(var m in s){var p=!!s[m];(n==null||p!==!!n[m])&&r.classList.toggle(m,p)}return s}function Xe(r,t,e,a){var n=r.__style;if(_||n!==t){var s=Oe(t);(!_||s!==r.getAttribute("style"))&&(s==null?r.removeAttribute("style"):r.style.cssText=s),r.__style=t}return a}const $e=()=>performance.now(),T={tick:r=>requestAnimationFrame(r),now:()=>$e(),tasks:new Set};function ie(){const r=T.now();T.tasks.forEach(t=>{t.c(r)||(T.tasks.delete(t),t.f())}),T.tasks.size!==0&&T.tick(ie)}function qe(r){let t;return T.tasks.size===0&&T.tick(ie),{promise:new Promise(e=>{T.tasks.add(t={c:r,f:e})}),abort(){T.tasks.delete(t)}}}function Ye(r){return function(...t){var e=t[0];return e.stopPropagation(),r?.apply(this,t)}}function Qe(r){return function(...t){var e=t[0];return e.preventDefault(),r?.apply(this,t)}}const O={API_BASE_URL:`https://us-central1-topic-tangle.cloudfunctions.net/tangle-api/tangle\r
`,POLL_INTERVAL:parseInt("2500")},U="topic-tangle-key-";async function Ue(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"])}async function Je(r,t){const e=await window.crypto.subtle.exportKey("jwk",t.publicKey);localStorage.setItem(`${U}${r}:public`,JSON.stringify(e));const a=await window.crypto.subtle.exportKey("jwk",t.privateKey);localStorage.setItem(`${U}${r}:private`,JSON.stringify(a))}async function Fe(r){const t=localStorage.getItem(`${U}${r}:public`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}async function je(r){const t=localStorage.getItem(`${U}${r}:private`);if(!t)return null;const e=JSON.parse(t);return await window.crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["sign"])}async function xe(r,t){const e=await je(r);if(!e)throw new Error(`Private key '${r}' not found.`);const n=new TextEncoder().encode(t),s=await window.crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},e,n);return btoa(String.fromCharCode(...new Uint8Array(s)))}async function He(r){let t=await Fe(r);if(!t){const a=await Ue();await Je(r,a),t=a.publicKey}const e=await window.crypto.subtle.exportKey("spki",t);return btoa(String.fromCharCode(...new Uint8Array(e)))}async function $(){const r="user",t=new Date().toISOString(),e=await He(r),a=await xe(r,t);return{"Content-Type":"application/json","X-User-Id":e,"X-Timestamp":t,"X-Signature":a}}class We{static POLL_INTERVAL=O.POLL_INTERVAL;static getRoomUrl(t,e=""){return`${O.API_BASE_URL}/rooms/${t}${e}`}static async createRoom(t){const e=await $(),a=await fetch(`${O.API_BASE_URL}/rooms`,{method:"POST",headers:e,body:JSON.stringify({topics:t.topics,minGroupSize:t.minGroupSize,maxGroupSize:t.maxGroupSize,style:t.style})});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to create room")}const n=await a.json();return n.createdAt=new Date(n.createdAt),n}static async getRoom(t){try{const e=await fetch(this.getRoomUrl(t));if(e.status===404)return null;if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to get room")}const a=await e.json();return a.createdAt=new Date(a.createdAt),a}catch(e){return console.error("Failed to get room:",e),null}}static async submitUserSelection(t){const e=await $();if(t.selectedTopics.length===0){const n=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"DELETE",headers:e});if(!n.ok){const s=await n.json();throw new Error(s.error||"Failed to delete selection")}return}const a=await fetch(this.getRoomUrl(t.roomId,"/selections"),{method:"POST",headers:e,body:JSON.stringify({selectedTopics:t.selectedTopics})});if(!a.ok){const n=await a.json();throw new Error(n.error||"Failed to submit selection")}}static async createBreakoutGroups(t,e){const a=await $(),n=await fetch(`${O.API_BASE_URL}/rooms/${t}/breakout`,{method:"POST",headers:a});if(!n.ok){const o=await n.json();throw new Error(o.error||"Failed to create breakout groups")}const s=await n.json();return s.createdAt=new Date(s.createdAt),s}static async getRoomData(t){try{const e=await $(),a=await fetch(this.getRoomUrl(t,"/data"),{headers:e});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to get room data")}const{selections:n,results:s}=await a.json();return{selections:n.map(o=>({...o,updatedAt:new Date(o.updatedAt)})),results:s?{...s,createdAt:new Date(s.createdAt)}:null}}catch(e){return console.error("Failed to get room data:",e),{selections:[],results:null}}}static createPollingSubscription(t,e,a=this.POLL_INTERVAL){let n;const s=async()=>{try{const o=await t();e(o)&&(n=setTimeout(s,a))}catch(o){console.error("Polling error:",o),n=setTimeout(s,a)}};return s(),()=>{n&&clearTimeout(n)}}}export{We as R,Xe as a,Ye as b,B as c,Ge as d,Be as e,He as g,ze as i,qe as l,Qe as p,T as r,Ve as s};
